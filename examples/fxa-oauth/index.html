<html>
<head>
  <script type="text/javascript" src="../../build/daybed.js"></script>
  <script type="text/javascript">
    var HOST = "http://localhost:8000";

    function getParameterByName(name) {
      name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
        results = regex.exec(location.search);
      return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }

    if (getParameterByName("code")) {
      var session = Daybed.fxaOAuth.getToken(HOST, {
        code: getParameterByName("code"),
        state: getParameterByName("state")
      }).then(function(data) {
        console.log(data);
        alert("Bienvenue " + data.profile.email);
      });
    } else {
      Daybed.fxaOAuth.login(HOST, {
        redirect_uri: document.location.href
      }).catch(function(err) {
        console.log(err);
      });
    }
  </script>
</head>
</html>
